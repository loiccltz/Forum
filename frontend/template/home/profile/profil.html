<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profil Utilisateur</title>
  <link rel="stylesheet" href="../../../public/css/profile.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>

<body>
  <div class="container rounded mt-5 mb-5">
    <div class="row">

      <!-- Colonne gauche : avatar + infos -->
      <div class="col-md-3 border-right">
        <div class="d-flex flex-column align-items-center text-center p-3 py-5">
          <img class="rounded-circle mt-5" width="150px"
               src="https://st3.depositphotos.com/15648834/17930/v/600/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg"
               alt="Avatar"/>
          <h5 class="mt-3">{{.Username}}</h5>
          <p class="text-black-50">{{.Email}}</p>
          <span class="badge bg-secondary mt-2">{{.Role}}</span>
        </div>
      </div>

      <!-- Colonne centrale : détails du profil -->
      <div class="col-md-5 border-right">
        <div class="p-3 py-5">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="text-right">Bonjour {{.Username}}</h4>
          </div>

          {{if .SuccessMessage}}
          <div class="alert alert-success">
            {{if eq .SuccessMessage "request_sent"}}
              Votre demande pour devenir modérateur a été envoyée avec succès !
            {{else}}
              Action effectuée avec succès !
            {{end}}
          </div>
          {{end}}

          <div class="row mt-2">
            <div class="col-md-6">
              <label class="labels">Nom d'utilisateur :</label>
              <p class="form-control">{{.Username}}</p>
            </div>
            <div class="col-md-6">
              <label class="labels">Email :</label>
              <p class="form-control">{{.Email}}</p>
            </div>
          </div>

          <div class="row mt-3">
            <div class="col-md-12">
              <label class="labels">Rôle actuel :</label>
              <p class="form-control">{{.Role}}</p>
            </div>
          </div>

          {{if eq .Role "user"}}
          <div class="mt-3 text-center">
            <form action="/request-moderator" method="POST">
              <button class="btn btn-info" type="submit">
                Demander à devenir modérateur
              </button>
            </form>
          </div>
          {{end}}

          {{if eq .Role "admin"}}
<div class="mt-4">
  <h5>Demandes pour devenir modérateur</h5>
  {{if .ModeratorRequests}}
    <ul class="list-group">
      {{range .ModeratorRequests}}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{.Username}} ({{.Email}})
          <form action="/handle-moderator-request" method="POST" class="d-flex gap-2">
            <input type="hidden" name="user_id" value="{{.ID}}">
            <button type="submit" name="action" value="approve" class="btn btn-success btn-sm">Accepter</button>
            <button type="submit" name="action" value="reject" class="btn btn-danger btn-sm">Refuser</button>
          </form>
        </li>
      {{end}}
    </ul>
  {{else}}
    <p class="text-muted">Aucune demande en attente.</p>
  {{end}}
</div>
{{end}}


          <div class="mt-5 text-center">
            <button class="btn btn-primary" type="button">
              Mettre à jour le profil
            </button>
          </div>
        </div>
      </div>

      <!-- Colonne droite : notifications + déconnexion -->
      <div class="col-md-4">
        <div class="p-3 py-5">
          <h5>Votre Activité</h5>
          {{template "notification_dropdown" .}}
          <form action="/logout" method="POST" class="mt-4">
            <button type="submit" class="btn btn-danger w-100">
              Déconnexion
            </button>
          </form>
        </div>
      </div>

    </div>
  </div>
</body>

</html>
